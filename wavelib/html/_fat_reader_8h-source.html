<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>WaveHC: C:/Arduino/arduino15/hardware/libraries/WaveHC/FatReader.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>C:/Arduino/arduino15/hardware/libraries/WaveHC/FatReader.h</h1><a href="_fat_reader_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Arduino FatReader Library</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2009 by William Greiman</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This file is part of the Arduino FatReader Library</span>
<a name="l00005"></a>00005 <span class="comment"> *</span>
<a name="l00006"></a>00006 <span class="comment"> * This Library is free software: you can redistribute it and/or modify</span>
<a name="l00007"></a>00007 <span class="comment"> * it under the terms of the GNU General Public License as published by</span>
<a name="l00008"></a>00008 <span class="comment"> * the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00009"></a>00009 <span class="comment"> * (at your option) any later version.</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> * This Library is distributed in the hope that it will be useful,</span>
<a name="l00012"></a>00012 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00013"></a>00013 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00014"></a>00014 <span class="comment"> * GNU General Public License for more details.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment"> * You should have received a copy of the GNU General Public License</span>
<a name="l00017"></a>00017 <span class="comment"> * along with the Arduino FatReader Library.  If not, see</span>
<a name="l00018"></a>00018 <span class="comment"> * &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00019"></a>00019 <span class="comment"> */</span>
<a name="l00020"></a>00020 <span class="preprocessor">#ifndef FatReader_h</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define FatReader_h</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="_sd_reader_8h.html">SdReader.h</a>"</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include "FatStructs.h"</span>
<a name="l00024"></a>00024 <span class="comment">// format dir.name into name[13] as standard 8.3 string</span>
<a name="l00025"></a>00025 <span class="keywordtype">void</span> <a class="code" href="_fat_reader_8h.html#92615e732bc88be43d8fa9e4e11112eb">dirName</a>(dir_t &amp;dir, <span class="keywordtype">char</span> name[]);
<a name="l00026"></a>00026 <span class="comment">// offsets for structures used in volume init</span>
<a name="l00028"></a><a class="code" href="_fat_reader_8h.html#6fa586d368bfe596129a43b4fc71077e">00028</a> <span class="comment"></span><span class="preprocessor">#define BPB_OFFSET 11</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span>
<a name="l00030"></a><a class="code" href="_fat_reader_8h.html#3653955d1badc3bba280a9a3694661d9">00030</a> <span class="preprocessor">#define BPB_COUNT 37   </span>
<a name="l00031"></a>00031 <span class="preprocessor"></span>
<a name="l00032"></a><a class="code" href="_fat_reader_8h.html#196e42d6a5b31f70d685029b65a311d4">00032</a> <span class="preprocessor">#define PART_OFFSET (512-64-2) </span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="comment">//macros for file types</span>
<a name="l00035"></a><a class="code" href="_fat_reader_8h.html#c1eb9d3fcc170add255e24652ae6d92e">00035</a> <span class="comment"></span><span class="preprocessor">#define DIR_IS_LONG_NAME(dir) (((dir).attributes &amp; DIR_ATT_LONG_NAME_MASK) == DIR_ATT_LONG_NAME)</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a><a class="code" href="_fat_reader_8h.html#7f4f6156b9251ac9dfc7ed053ff84791">00037</a> <span class="preprocessor">#define DIR_ATT_FILE_TYPE_MASK (DIR_ATT_VOLUME_ID | DIR_ATT_DIRECTORY)</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="_fat_reader_8h.html#336e32b400cbc1695b5d2b392ab20b30">00039</a> <span class="preprocessor">#define DIR_IS_FILE(dir) (((dir).attributes &amp; DIR_ATT_FILE_TYPE_MASK) == 0)</span>
<a name="l00040"></a>00040 <span class="preprocessor"></span>
<a name="l00041"></a><a class="code" href="_fat_reader_8h.html#7f6e01da856a1b74459854431eb5f52f">00041</a> <span class="preprocessor">#define DIR_IS_SUBDIR(dir) (((dir).attributes &amp; DIR_ATT_FILE_TYPE_MASK) == DIR_ATT_DIRECTORY)</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00045"></a><a class="code" href="class_fat_volume.html">00045</a> <span class="keyword">class </span><a class="code" href="class_fat_volume.html" title="FatVolume provides access to FAT volumes.">FatVolume</a> {
<a name="l00047"></a><a class="code" href="class_fat_volume.html#e56812afb7d1ce309280cdcb9f749200">00047</a>   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="class_fat_reader.html" title="FatReader implements a minimal FAT16/FAT32 file reader class.">FatReader</a>;
<a name="l00048"></a>00048   uint8_t blocksPerCluster_;
<a name="l00049"></a>00049   uint32_t blocksPerFat_;
<a name="l00050"></a>00050   uint32_t clusterCount_;
<a name="l00051"></a>00051   uint32_t dataStartBlock_;
<a name="l00052"></a>00052   uint8_t fatCount_;
<a name="l00053"></a>00053   uint32_t fatStartBlock_;
<a name="l00054"></a>00054   uint8_t fatType_;
<a name="l00055"></a>00055   <a class="code" href="class_sd_reader.html" title="Hardware access class for SD flash cards.">SdReader</a> *rawDevice_;
<a name="l00056"></a>00056   uint16_t rootDirEntryCount_;
<a name="l00057"></a>00057   uint32_t rootDirStart_;
<a name="l00058"></a>00058   uint32_t totalBlocks_;
<a name="l00059"></a>00059   uint32_t chainSize(uint32_t cluster);
<a name="l00060"></a>00060   uint32_t nextCluster(uint32_t cluster);
<a name="l00061"></a>00061   uint8_t rawRead(uint32_t block, uint16_t offset, uint8_t *dst, uint16_t count) {
<a name="l00062"></a>00062     <span class="keywordflow">return</span> rawDevice_-&gt;<a class="code" href="class_sd_reader.html#689af41663bfa49fe1397eba30bf136e">readData</a>(block, offset, dst, count);}
<a name="l00063"></a>00063   uint8_t validCluster(uint32_t cluster) {
<a name="l00064"></a>00064    <span class="keywordflow">return</span> (1 &lt; cluster &amp;&amp; cluster &lt; (clusterCount_ + 2));}
<a name="l00065"></a>00065 <span class="keyword">public</span>:
<a name="l00067"></a><a class="code" href="class_fat_volume.html#660458b36834806c7824ff63035eda93">00067</a>   <a class="code" href="class_fat_volume.html#660458b36834806c7824ff63035eda93">FatVolume</a>(<span class="keywordtype">void</span>) : fatType_(0){}
<a name="l00079"></a><a class="code" href="class_fat_volume.html#44b429bfbabbdffdd5ddc4c189625ae7">00079</a>   uint8_t <a class="code" href="class_fat_volume.html#44b429bfbabbdffdd5ddc4c189625ae7">init</a>(<a class="code" href="class_sd_reader.html" title="Hardware access class for SD flash cards.">SdReader</a> &amp;dev) { <span class="keywordflow">return</span> <a class="code" href="class_fat_volume.html#44b429bfbabbdffdd5ddc4c189625ae7">init</a>(dev, 1) ? 1 : <a class="code" href="class_fat_volume.html#44b429bfbabbdffdd5ddc4c189625ae7">init</a>(dev, 0);}
<a name="l00080"></a>00080   uint8_t <a class="code" href="class_fat_volume.html#44b429bfbabbdffdd5ddc4c189625ae7">init</a>(<a class="code" href="class_sd_reader.html" title="Hardware access class for SD flash cards.">SdReader</a> &amp;dev, uint8_t part);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082   <span class="comment">// inline functions that return volume info</span>
<a name="l00084"></a><a class="code" href="class_fat_volume.html#20339c9b52abd7727533571d17d5f93e">00084</a> <span class="comment"></span>  uint8_t <a class="code" href="class_fat_volume.html#20339c9b52abd7727533571d17d5f93e">blocksPerCluster</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> blocksPerCluster_;}
<a name="l00086"></a><a class="code" href="class_fat_volume.html#5340b88fb8a0123e1fbf6015f79e7fbd">00086</a>   uint32_t <a class="code" href="class_fat_volume.html#5340b88fb8a0123e1fbf6015f79e7fbd">blocksPerFat</a>(<span class="keywordtype">void</span>)  {<span class="keywordflow">return</span> blocksPerFat_;}
<a name="l00088"></a><a class="code" href="class_fat_volume.html#a554ba93ebe105eb9a16e56fe4306bb0">00088</a>   uint32_t <a class="code" href="class_fat_volume.html#a554ba93ebe105eb9a16e56fe4306bb0">clusterCount</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> clusterCount_;}
<a name="l00090"></a><a class="code" href="class_fat_volume.html#33cc764806ce4f800a5d33682c89d01e">00090</a>   uint32_t <a class="code" href="class_fat_volume.html#33cc764806ce4f800a5d33682c89d01e">dataStartBlock</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> dataStartBlock_;}
<a name="l00092"></a><a class="code" href="class_fat_volume.html#93833ef3871879c6da4b8e34478017d1">00092</a>   uint8_t <a class="code" href="class_fat_volume.html#93833ef3871879c6da4b8e34478017d1">fatCount</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> fatCount_;}
<a name="l00094"></a><a class="code" href="class_fat_volume.html#a24225d2d4e42dac2827f1761223546c">00094</a>   uint32_t <a class="code" href="class_fat_volume.html#a24225d2d4e42dac2827f1761223546c">fatStartBlock</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> fatStartBlock_;}
<a name="l00096"></a><a class="code" href="class_fat_volume.html#80a3b0d0da4bdf821bebcf16c2c25e12">00096</a>   uint8_t <a class="code" href="class_fat_volume.html#80a3b0d0da4bdf821bebcf16c2c25e12">fatType</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> fatType_;}
<a name="l00098"></a><a class="code" href="class_fat_volume.html#943e9506746bb8f9385f7cb35aebc4f9">00098</a>   <a class="code" href="class_sd_reader.html" title="Hardware access class for SD flash cards.">SdReader</a> *<a class="code" href="class_fat_volume.html#943e9506746bb8f9385f7cb35aebc4f9">rawDevice</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> rawDevice_;}
<a name="l00100"></a><a class="code" href="class_fat_volume.html#61115a430871e6762ed6828852b508ef">00100</a>   uint32_t <a class="code" href="class_fat_volume.html#61115a430871e6762ed6828852b508ef">rootDirEntryCount</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> rootDirEntryCount_;}
<a name="l00103"></a><a class="code" href="class_fat_volume.html#91d1ad71e78e7237e9f4f6874815d687">00103</a>   uint32_t <a class="code" href="class_fat_volume.html#91d1ad71e78e7237e9f4f6874815d687">rootDirStart</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> rootDirStart_;}
<a name="l00105"></a><a class="code" href="class_fat_volume.html#5cbd302cb0ebe85209d6603f21d60773">00105</a>   uint32_t <a class="code" href="class_fat_volume.html#5cbd302cb0ebe85209d6603f21d60773">totalBlocks</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> totalBlocks_;}
<a name="l00106"></a>00106 };
<a name="l00110"></a><a class="code" href="class_fat_reader.html">00110</a> <span class="keyword">class </span><a class="code" href="class_fat_reader.html" title="FatReader implements a minimal FAT16/FAT32 file reader class.">FatReader</a> {
<a name="l00111"></a>00111 <span class="comment">// values for type_</span>
<a name="l00113"></a><a class="code" href="_fat_reader_8h.html#5e74f7249bc7052746970bdc1714adc4">00113</a> <span class="comment"></span><span class="preprocessor">#define FAT_READER_TYPE_CLOSED 0</span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a><a class="code" href="_fat_reader_8h.html#6e5bf0fa44621d315e0fc831a70e9991">00115</a> <span class="preprocessor">#define FAT_READER_TYPE_NORMAL 1</span>
<a name="l00116"></a>00116 <span class="preprocessor"></span>
<a name="l00117"></a><a class="code" href="_fat_reader_8h.html#9bad12f0fad15ec81b2bd4dc03c11c62">00117</a> <span class="preprocessor">#define FAT_READER_TYPE_ROOT16 2</span>
<a name="l00118"></a>00118 <span class="preprocessor"></span>
<a name="l00119"></a><a class="code" href="_fat_reader_8h.html#f50c9cf3a5320343e38fcaa0650aa642">00119</a> <span class="preprocessor">#define FAT_READER_TYPE_ROOT32 3</span>
<a name="l00120"></a>00120 <span class="preprocessor"></span>
<a name="l00121"></a><a class="code" href="_fat_reader_8h.html#1e7d04d071058175a8bfd47ef49aa729">00121</a> <span class="preprocessor">#define FAT_READER_TYPE_SUBDIR 4</span>
<a name="l00122"></a>00122 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="_fat_reader_8h.html#aed9cd6c10e94569ada791c891900aa2">00123</a> <span class="preprocessor">#define FAT_READER_TYPE_MIN_DIR FAT_READER_TYPE_ROOT16</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>  uint8_t type_;
<a name="l00125"></a>00125   uint32_t fileSize_;
<a name="l00126"></a>00126   uint32_t readCluster_;  
<a name="l00127"></a>00127   uint32_t readPosition_;
<a name="l00128"></a>00128   uint32_t firstCluster_;
<a name="l00129"></a>00129   <a class="code" href="class_fat_volume.html" title="FatVolume provides access to FAT volumes.">FatVolume</a> *vol_;
<a name="l00130"></a>00130   int16_t readBlockData(uint8_t *dst, uint16_t count);
<a name="l00131"></a>00131 <span class="keyword">public</span>:
<a name="l00133"></a><a class="code" href="class_fat_reader.html#86310786bba8ac0de7cd720517e65931">00133</a>   <a class="code" href="class_fat_reader.html#86310786bba8ac0de7cd720517e65931">FatReader</a>(<span class="keywordtype">void</span>) : type_(<a class="code" href="_fat_reader_8h.html#5e74f7249bc7052746970bdc1714adc4">FAT_READER_TYPE_CLOSED</a>) {}
<a name="l00134"></a>00134   uint8_t <a class="code" href="class_fat_reader.html#9e84e308ab2a06c92ceda5b3692d6de4">openRoot</a>(<a class="code" href="class_fat_volume.html" title="FatVolume provides access to FAT volumes.">FatVolume</a> &amp;vol);
<a name="l00135"></a>00135   uint8_t <a class="code" href="class_fat_reader.html#f7cd8e65a1982f8a5a6568b8675ce99e">open</a>(<a class="code" href="class_fat_volume.html" title="FatVolume provides access to FAT volumes.">FatVolume</a> &amp;vol, dir_t &amp;dir);
<a name="l00136"></a>00136   uint8_t <a class="code" href="class_fat_reader.html#f7cd8e65a1982f8a5a6568b8675ce99e">open</a>(<a class="code" href="class_fat_reader.html" title="FatReader implements a minimal FAT16/FAT32 file reader class.">FatReader</a> &amp;dir, <span class="keywordtype">char</span> *name);
<a name="l00137"></a>00137   int16_t <a class="code" href="class_fat_reader.html#de600b8de8e09923debc91e10d06a242">read</a>(uint8_t *dst, uint16_t count);
<a name="l00138"></a>00138   int8_t <a class="code" href="class_fat_reader.html#f4fa9a4bad17f5fb24084a23229f3003">readDir</a>(dir_t &amp;dir);
<a name="l00139"></a>00139   <span class="keywordtype">void</span> <a class="code" href="class_fat_reader.html#c5c31c93f9d8aa2beb504d8e67d8a9c9">rewind</a>(<span class="keywordtype">void</span>);
<a name="l00140"></a>00140   uint8_t <a class="code" href="class_fat_reader.html#525597a91124c2dfc15f8afb6435d57b">seekCur</a>(uint32_t pos);
<a name="l00141"></a>00141   <span class="comment">//inline functions</span>
<a name="l00143"></a><a class="code" href="class_fat_reader.html#e9f8aa3eeffd71329297fb7e52eabc99">00143</a> <span class="comment"></span>  <span class="keywordtype">void</span> <a class="code" href="class_fat_reader.html#e9f8aa3eeffd71329297fb7e52eabc99">close</a>(<span class="keywordtype">void</span>) {type_ = 0;}
<a name="l00145"></a><a class="code" href="class_fat_reader.html#1834c3b421c1eba252b0f051048cfb43">00145</a>   uint32_t <a class="code" href="class_fat_reader.html#1834c3b421c1eba252b0f051048cfb43">fileSize</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> fileSize_;}
<a name="l00147"></a><a class="code" href="class_fat_reader.html#9cf8ccb758f78ffb07bcde69bb9c1831">00147</a>   uint32_t <a class="code" href="class_fat_reader.html#9cf8ccb758f78ffb07bcde69bb9c1831">firstCluster</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> firstCluster_;}
<a name="l00149"></a><a class="code" href="class_fat_reader.html#640d1bc52b59ef2661432a7a36c43b7f">00149</a>   uint8_t <a class="code" href="class_fat_reader.html#640d1bc52b59ef2661432a7a36c43b7f">isDir</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> type_ &gt;= <a class="code" href="_fat_reader_8h.html#aed9cd6c10e94569ada791c891900aa2">FAT_READER_TYPE_MIN_DIR</a>;}
<a name="l00151"></a><a class="code" href="class_fat_reader.html#a75998d7d2cc1c45f9b9b156f9da2479">00151</a>   uint8_t <a class="code" href="class_fat_reader.html#a75998d7d2cc1c45f9b9b156f9da2479">isFile</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> type_ == <a class="code" href="_fat_reader_8h.html#6e5bf0fa44621d315e0fc831a70e9991">FAT_READER_TYPE_NORMAL</a>;}
<a name="l00153"></a><a class="code" href="class_fat_reader.html#e08c101eac81d75f6ef30b18b26fa6c5">00153</a>   uint8_t <a class="code" href="class_fat_reader.html#e08c101eac81d75f6ef30b18b26fa6c5">isOpen</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> type_ == <a class="code" href="_fat_reader_8h.html#6e5bf0fa44621d315e0fc831a70e9991">FAT_READER_TYPE_NORMAL</a>;}
<a name="l00155"></a><a class="code" href="class_fat_reader.html#3d66a1d4e0d18ff73f413bc427a96066">00155</a>   uint32_t <a class="code" href="class_fat_reader.html#3d66a1d4e0d18ff73f413bc427a96066">readCluster</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> readCluster_;}
<a name="l00157"></a><a class="code" href="class_fat_reader.html#79ab89b12da6190cd2e5a3d05e306465">00157</a>   uint32_t <a class="code" href="class_fat_reader.html#79ab89b12da6190cd2e5a3d05e306465">readPosition</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> readPosition_;}
<a name="l00166"></a><a class="code" href="class_fat_reader.html#a6e54cdd9aef58b223b0e3dc25ba172d">00166</a>   uint8_t <a class="code" href="class_fat_reader.html#a6e54cdd9aef58b223b0e3dc25ba172d">seekSet</a>(uint32_t pos) {
<a name="l00167"></a>00167     <span class="keywordflow">if</span> (pos &gt;= readPosition_) <span class="keywordflow">return</span> <a class="code" href="class_fat_reader.html#525597a91124c2dfc15f8afb6435d57b">seekCur</a>(pos - readPosition_);
<a name="l00168"></a>00168     <a class="code" href="class_fat_reader.html#c5c31c93f9d8aa2beb504d8e67d8a9c9">rewind</a>(); <span class="keywordflow">return</span> <a class="code" href="class_fat_reader.html#525597a91124c2dfc15f8afb6435d57b">seekCur</a>(pos);}
<a name="l00173"></a><a class="code" href="class_fat_reader.html#b96368c87d75045cc1afcb67ac9529ba">00173</a>   uint8_t <a class="code" href="class_fat_reader.html#b96368c87d75045cc1afcb67ac9529ba">type</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> type_;}
<a name="l00175"></a><a class="code" href="class_fat_reader.html#06b54e86edc9ebcaad9daaacca4f28f7">00175</a>   <a class="code" href="class_fat_volume.html" title="FatVolume provides access to FAT volumes.">FatVolume</a> *<a class="code" href="class_fat_reader.html#06b54e86edc9ebcaad9daaacca4f28f7">volume</a>(<span class="keywordtype">void</span>) {<span class="keywordflow">return</span> vol_;}
<a name="l00176"></a>00176 };
<a name="l00177"></a>00177 <span class="preprocessor">#endif//FatReader_h</span>
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon May 11 05:57:06 2009 for WaveHC by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
